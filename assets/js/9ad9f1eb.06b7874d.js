"use strict";(self.webpackChunkdocs_oasis_io=self.webpackChunkdocs_oasis_io||[]).push([[494],{6326:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"build/rofl/deployment","title":"Deployment on Testnet and Mainnet","description":"As a first step we need to decide which ParaTime the ROFL app will authenticate","source":"@site/docs/build/rofl/deployment.md","sourceDirName":"build/rofl","slug":"/build/rofl/deployment","permalink":"/build/rofl/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/oasis-sdk/edit/main/docs/rofl/deployment.md","tags":[],"version":"current","lastUpdatedAt":1740674219000,"frontMatter":{},"sidebar":"developers","previous":{"title":"Application","permalink":"/build/rofl/app"},"next":{"title":"Features","permalink":"/build/rofl/features"}}');var a=t(4848),r=t(8453);const s={},o="Deployment on Testnet and Mainnet",l={},d=[{value:"Deploying the ROFL App Bundle",id:"deploying-the-rofl-app-bundle",level:2},{value:"Checking That the ROFL App is Running",id:"checking-that-the-rofl-app-is-running",level:2},{value:"Checking That the Oracle is Getting Updated",id:"checking-that-the-oracle-is-getting-updated",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"deployment-on-testnet-and-mainnet",children:"Deployment on Testnet and Mainnet"})}),"\n",(0,a.jsxs)(n.p,{children:["As a first step we need to decide which ParaTime the ROFL app will authenticate\nto. This can be any ParaTime which has the ROFL module installed. For the rest\nof this section we will be using ",(0,a.jsx)(n.a,{href:"/build/sapphire/network",children:"Sapphire Testnet"})," which has\nall of the required functionality."]}),"\n",(0,a.jsx)(n.h2,{id:"deploying-the-rofl-app-bundle",children:"Deploying the ROFL App Bundle"}),"\n",(0,a.jsxs)(n.p,{children:["ROFL apps are deployed through Oasis nodes running on systems that support the\ntargeted TEE (e.g. Intel TDX). If you don't have a running node where you could\ndeploy your ROFL app, please first make sure that you have a client node with\nthe Sapphire Testnet runtime configured (see the ",(0,a.jsx)(n.a,{href:"/node/run-your-node/paratime-client-node#configuring-tee-paratime-client-node",children:"client node documentation"})," for\ninstructions on setting one up)."]}),"\n",(0,a.jsxs)(n.p,{children:["After your node is set up, include the built ",(0,a.jsx)(n.code,{children:"myapp.default.orc"}),"\n",(0,a.jsx)(n.a,{href:"/build/rofl/app#build",children:"which we prepared earlier"})," in the ",(0,a.jsx)(n.code,{children:"runtime"})," section in your configuration as\nfollows:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"runtime:\n  # ... other options omitted ...\n  paths:\n    - /node/runtime/sapphire-paratime.orc\n    - /node/runtime/myapp.default.orc\n"})}),"\n",(0,a.jsx)(n.p,{children:"Note the appropriate paths to both the latest Sapphire Testnet runtime and the\nROFL app bundle. Before proceeding with the rest of the chapter, please make\nsure that the node is fully synchronized with Sapphire Testnet."}),"\n",(0,a.jsx)(n.p,{children:"The node will also need to cover any transaction fees that are required to\nmaintain registration of the ROFL app. First, determine the address of the node\nyou are connecting to by running the following:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"oasis-node identity show-address -a unix:/node/data/internal.sock\n"})}),"\n",(0,a.jsx)(n.p,{children:"This should output an address like the following:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"oasis1qp6tl30ljsrrqnw2awxxu2mtxk0qxyy2nymtsy90\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You can then ",(0,a.jsx)(n.a,{href:"/general/manage-tokens/cli/account#transfer",children:"transfer some tokens"})," to this address on Sapphire Testnet to make\nsure it will have funds to pay for registration fees:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"oasis account transfer 10 oasis1qp6tl30ljsrrqnw2awxxu2mtxk0qxyy2nymtsy90 \\\n  --network testnet --paratime sapphire\n"})}),"\n",(0,a.jsx)(n.h2,{id:"checking-that-the-rofl-app-is-running",children:"Checking That the ROFL App is Running"}),"\n",(0,a.jsx)(n.p,{children:"In order to check that the ROFL app is running and has successfully registered\non chain, you can use the following command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"oasis rofl show\n"})}),"\n",(0,a.jsx)(n.p,{children:"This will output some information about the registered ROFL app, its policy and\nits currently live instances:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'App ID:        rofl1qqn9xndja7e2pnxhttktmecvwzz0yqwxsquqyxdf\nAdmin:         oasis1qrydpazemvuwtnp3efm7vmfvg3tde044qg6cxwzx\nStaked amount: 10000.0 \nPolicy:\n  {\n    "quotes": {\n      "pcs": {\n        "tcb_validity_period": 30,\n        "min_tcb_evaluation_data_number": 17,\n        "tdx": {}\n      }\n    },\n    "enclaves": [\n      "z+StFagJfBOdGlUGDMH7RlcNUm1uqYDUZDG+g3z2ik8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==",\n      "6KfY4DqD1Vi+H7aUn5FwwLobEzERHoOit7xsrPNz3eUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="\n    ],\n    "endorsements": [\n      {\n        "any": {}\n      }\n    ],\n    "fees": 2,\n    "max_expiration": 3\n  }\n\n=== Instances ===\n- RAK:        AQhV3X660/+bR8REaWYkZNR6eAysFShylhe+7Ph00PM=\n  Node ID:    DbeoxcRwDO4Wh8bwq5rAR7wzhiB+LeYn+y7lFSGAZ7I=\n  Expiration: 9\n'})}),"\n",(0,a.jsx)(n.p,{children:"Here you can see that a single instance of the ROFL app is running on the given\nnode, its public runtime attestation key (RAK) and the epoch at which its\nregistration will expire if not refreshed. ROFL apps must periodically refresh\ntheir registrations to ensure they don't expire."}),"\n",(0,a.jsx)(n.h2,{id:"checking-that-the-oracle-is-getting-updated",children:"Checking That the Oracle is Getting Updated"}),"\n",(0,a.jsxs)(n.p,{children:["In order to check that the oracle is working, you can use the prepared\n",(0,a.jsx)(n.code,{children:"oracle-query"})," task in the Hardhat project. Simply run:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"npx hardhat oracle-query 0x1234845aaB7b6CD88c7fAd9E9E1cf07638805b20 --network sapphire-testnet\n"})}),"\n",(0,a.jsx)(n.p,{children:"And you should get an output like the following:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Using oracle contract deployed at 0x1234845aaB7b6CD88c7fAd9E9E1cf07638805b20\nROFL app:  rofl1qqn9xndja7e2pnxhttktmecvwzz0yqwxsquqyxdf\nThreshold: 1\nLast observation: 63990\nLast update at:   656\n"})}),"\n",(0,a.jsx)(n.p,{children:"That's it! Your first ROFL oracle is running!"})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(6540);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);