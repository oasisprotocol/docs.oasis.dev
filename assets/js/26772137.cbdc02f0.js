"use strict";(self.webpackChunkdocs_oasis_io=self.webpackChunkdocs_oasis_io||[]).push([[732],{5741:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"build/opl/opl-sdk/README","title":"OPL SDK","description":"OPL sdk","source":"@site/docs/build/opl/opl-sdk/README.md","sourceDirName":"build/opl/opl-sdk","slug":"/build/opl/opl-sdk/","permalink":"/build/opl/opl-sdk/","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/build/opl/opl-sdk/README.md","tags":[],"version":"current","lastUpdatedAt":1740674219000,"frontMatter":{"description":"OPL sdk"},"sidebar":"developers","previous":{"title":"Approving the Fee Payer","permalink":"/build/opl/router-protocol/approve"},"next":{"title":"Ping Example","permalink":"/build/opl/opl-sdk/ping-example"}}');var a=n(4848),s=n(8453),o=n(5537),i=n(9329);const l={description:"OPL sdk"},c="OPL SDK",d={},u=[{value:"Overview",id:"overview",level:2},{value:"Fees",id:"fees",level:2},{value:"Quickstart",id:"quickstart",level:2},{value:"Setup",id:"setup",level:3},{value:"Sapphire Contract",id:"sapphire-contract",level:3},{value:"Home Contract",id:"home-contract",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"opl-sdk",children:"OPL SDK"})}),"\n",(0,a.jsxs)(t.p,{children:["The OPL SDK is available in our ",(0,a.jsx)(t.a,{href:"https://www.npmjs.com/package/@oasisprotocol/sapphire-contracts",children:"Solidity library"}),".\nThe SDK wraps the Celer Inter-Chain Message (IM) and makes it easy and straight\nforward to integrate ",(0,a.jsx)(t.a,{href:"https://oasisprotocol.org/sapphire",children:"Sapphire"})," and its privacy features into your existing or\nfuture Web3 applications."]}),"\n",(0,a.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{alt:"Transaction Flow",src:n(1496).A+"",width:"1124",height:"387"})}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["The ",(0,a.jsx)(t.strong,{children:"user"})," submits a transaction on the Home network to a contract which uses\n",(0,a.jsx)(t.code,{children:"postMessage"})," to emit an event about a the cross-chain message."]}),"\n",(0,a.jsxs)(t.li,{children:["The ",(0,a.jsxs)(t.strong,{children:["Celer ",(0,a.jsx)(t.em,{children:"State Guardian Network"})," (SGN)"]})," monitors for transactions which\ntrigger a cross-chain message event and create attestation."]}),"\n",(0,a.jsxs)(t.li,{children:["The ",(0,a.jsx)(t.strong,{children:"Executor"})," waits, when the SGN approves the message the Executor submits a\ntransaction to the target contract on Sapphire."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"fees",children:"Fees"}),"\n",(0,a.jsx)(t.p,{children:"The Home Contract pays the SGN to watch and approve the message, but the\nExecutor needs to be run by somebody willing to pay for the gas to submit\ntransactions to the destination chain."}),"\n",(0,a.jsxs)(t.p,{children:["More details to the Celer Executor you can find ",(0,a.jsx)(t.a,{href:"/build/opl/celer/#executor",children:"here"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"quickstart",children:"Quickstart"}),"\n",(0,a.jsx)(t.p,{children:"A pair of contracts are linked bidirectionally 1-1 to each other across chains,\nwith one end on Sapphire and the other on a supported EVM-compatible chain (the\nHome Network). They can post and receive messages to & from each other using the\nmessage-passing bridge, but must register endpoints to define which messages\nthey handle from each other."}),"\n",(0,a.jsx)(t.h3,{id:"setup",children:"Setup"}),"\n",(0,a.jsxs)(t.p,{children:["Start by adding the ",(0,a.jsx)(t.a,{href:"http://npmjs.com/package/@oasisprotocol/sapphire-contracts",children:(0,a.jsx)(t.code,{children:"@oasisprotocol/sapphire-contracts"})})," NPM package to your\nHardhat project so you can import ",(0,a.jsx)(t.code,{children:"OPL.sol"}),":"]}),"\n",(0,a.jsxs)(o.A,{groupId:"npm2yarn",children:[(0,a.jsx)(i.A,{value:"npm",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"npm install @oasisprotocol/sapphire-contracts\n"})})}),(0,a.jsx)(i.A,{value:"pnpm",label:"pnpm",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"pnpm add @oasisprotocol/sapphire-contracts\n"})})}),(0,a.jsx)(i.A,{value:"yarn",label:"Yarn",children:(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"yarn add @oasisprotocol/sapphire-contracts\n"})})})]}),"\n",(0,a.jsx)(t.p,{children:"Now define the two contracts:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["A contract on ",(0,a.jsx)(t.strong,{children:"Sapphire"})," which runs inside the confidential ",(0,a.jsx)(t.code,{children:"enclave"})]}),"\n",(0,a.jsxs)(t.li,{children:["A contract on the ",(0,a.jsx)(t.strong,{children:"home chain"})," as a ",(0,a.jsx)(t.code,{children:"host"})," which triggers the example"]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"sapphire-contract",children:"Sapphire Contract"}),"\n",(0,a.jsxs)(t.p,{children:["On Sapphire use the constructor to provide the Sapphire contract with the\nlocation (address and chain) of the contract on the Home chain and register an\nendpoint called ",(0,a.jsx)(t.code,{children:"secretExample"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-solidity",children:'import {Enclave, Result, autoswitch} from "@oasisprotocol/sapphire-contracts/contracts/OPL.sol";\n\ncontract SapphireContract is Enclave {\n    constructor(address otherEnd, string chain) Enclave(otherEnd, autoswitch(chain)) {\n        registerEndpoint("secretExample", on_example);\n    }\n    function on_example(bytes calldata _args) internal returns (Result) {\n        (uint256 a, bool b) = abi.decode(args, (uint256, bool));\n        // TODO: do confidential things here\n        return Result.Success;\n    }\n}\n'})}),"\n",(0,a.jsx)(t.h3,{id:"home-contract",children:"Home Contract"}),"\n",(0,a.jsxs)(t.p,{children:["On the other chain, define your contract which can be called via\n",(0,a.jsx)(t.code,{children:"triggerExample"})," to send a message to the contract on Sapphire using the\n",(0,a.jsx)(t.code,{children:"postMessage"})," interface."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-solidity",children:'import {Host, Result} from "@oasisprotocol/sapphire-contracts/contracts/OPL.sol";\n\ncontract HomeContract is Host {\n    constructor(address otherEnd) Host(otherEnd) {\n    }\n    function triggerExample (uint256 a, bool b) external payable {\n        postMessage("secretExample", abi.encode(a, b));\n    }\n}\n'})}),"\n",(0,a.jsxs)(t.p,{children:["After a few minutes the bridge will detect and then the executor will invoke the\n",(0,a.jsx)(t.code,{children:"SapphireContract.on_example"})," method."]}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsxs)(t.p,{children:["As noted in the ",(0,a.jsx)(t.a,{href:"#fees",children:"fees"})," section, an executor needs to relay your messages.\nPlease refer to the Celer ",(0,a.jsx)(t.a,{href:"/build/opl/celer/#executor",children:"Executor"})," section on how to get on\nthe shared Message Executor or how to set up your own executor."]})})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},9329:(e,t,n)=>{n.d(t,{A:()=>o});n(6540);var r=n(4164);const a={tabItem:"tabItem_Ymn6"};var s=n(4848);function o(e){let{children:t,hidden:n,className:o}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(a.tabItem,o),hidden:n,children:t})}},5537:(e,t,n)=>{n.d(t,{A:()=>y});var r=n(6540),a=n(4164),s=n(5627),o=n(6347),i=n(372),l=n(604),c=n(1861),d=n(8749);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const a=(0,o.W6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(a.location.search);t.set(s,e),a.replace({...a.location,search:t.toString()})}),[s,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,s=h(e),[o,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:s}))),[c,u]=m({queryString:n,groupId:a}),[f,x]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,s]=(0,d.Dv)(n);return[a,(0,r.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:a}),g=(()=>{const e=c??f;return p({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{g&&l(g)}),[g]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),x(e)}),[u,x,s]),tabValues:s}}var x=n(9136);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=n(4848);function v(e){let{className:t,block:n,selectedValue:r,selectValue:o,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),d=e=>{const t=e.currentTarget,n=l.indexOf(t),a=i[n].value;a!==r&&(c(t),o(a))},u=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},t),children:i.map((e=>{let{value:t,label:n,attributes:s}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>{l.push(e)},onKeyDown:u,onClick:d,...s,className:(0,a.A)("tabs__item",g.tabItem,s?.className,{"tabs__item--active":r===t}),children:n??t},t)}))})}function j(e){let{lazy:t,children:n,selectedValue:s}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function w(e){const t=f(e);return(0,b.jsxs)("div",{className:(0,a.A)("tabs-container",g.tabList),children:[(0,b.jsx)(v,{...t,...e}),(0,b.jsx)(j,{...t,...e})]})}function y(e){const t=(0,x.A)();return(0,b.jsx)(w,{...e,children:u(e.children)},String(t))}},1496:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/opl-contract-flow.mmd-8cc4302842e50f8d3da2979cd64e85da.svg"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>i});var r=n(6540);const a={},s=r.createContext(a);function o(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);