"use strict";(self.webpackChunkdocs_oasis_io=self.webpackChunkdocs_oasis_io||[]).push([[8104],{3181:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>l,frontMatter:()=>a,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"node/run-your-node/advanced/sync-node-using-state-sync","title":"Using State Sync for Quick Bootstraping","description":"The State Sync is a way to quickly bootstrap a full Oasis node (either a","source":"@site/docs/node/run-your-node/advanced/sync-node-using-state-sync.md","sourceDirName":"node/run-your-node/advanced","slug":"/node/run-your-node/advanced/sync-node-using-state-sync","permalink":"/node/run-your-node/advanced/sync-node-using-state-sync","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/node/run-your-node/advanced/sync-node-using-state-sync.md","tags":[],"version":"current","lastUpdatedAt":1740674219000,"frontMatter":{},"sidebar":"operators","previous":{"title":"Advanced","permalink":"/node/run-your-node/advanced"},"next":{"title":"Copy State from One Node to the Other","permalink":"/node/run-your-node/advanced/copy-state-from-one-node-to-the-other"}}');var o=t(4848),i=t(8453);const a={},d="Using State Sync for Quick Bootstraping",r={},h=[{value:"Obtaining Trusted Height and Hash",id:"obtaining-trusted-height-and-hash",level:3},{value:"Block Explorers",id:"block-explorers",level:4},{value:"A Trusted Node",id:"a-trusted-node",level:4},{value:"Public Rosetta Gateway",id:"public-rosetta-gateway",level:4},{value:"Oasis CLI",id:"oasis-cli",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"using-state-sync-for-quick-bootstraping",children:"Using State Sync for Quick Bootstraping"})}),"\n",(0,o.jsxs)(n.p,{children:["The State Sync is a way to ",(0,o.jsx)(n.strong,{children:"quickly bootstrap"})," a ",(0,o.jsx)(n.strong,{children:"full Oasis node"})," (either a\n",(0,o.jsx)(n.a,{href:"/node/run-your-node/validator-node",children:"validator node"})," or a\n",(0,o.jsx)(n.a,{href:"/node/run-your-node/non-validator-node",children:"non-validator node"}),") by using the\n",(0,o.jsx)(n.a,{href:"https://docs.tendermint.com/main/tendermint-core/light-client.html",children:"Tendermint's Light Client protocol"}),". It allows one to initialize a node from a\ntrusted height, its corresponding block's header and a trusted validator set\n(given in the ",(0,o.jsx)(n.a,{href:"/node/genesis-doc",children:"genesis document"}),"). It does so by securely\nupdating the node's trusted state by requesting and verifying a minimal set of\ndata from the network's full nodes."]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["If you have access to an Oasis node that is synced with the latest height,\nanother option to speed bootstraping a new Oasis node is to ",(0,o.jsx)(n.a,{href:"/node/run-your-node/advanced/copy-state-from-one-node-to-the-other",children:"copy state from one\nnode to the other"}),"."]})}),"\n",(0,o.jsx)(n.admonition,{type:"caution",children:(0,o.jsxs)(n.p,{children:["Tendermint's Light Client protocol requires at least 1 full node to be correct\nto be able to ",(0,o.jsx)(n.a,{href:"https://docs.tendermint.com/main/tendermint-core/light-client.html#where-to-obtain-trusted-height-hash",children:"detect and submit evidence for a light client attack"}),"."]})}),"\n",(0,o.jsxs)(n.p,{children:["To configure your node to use the state sync, amend your node's configuration\n(i.e. ",(0,o.jsx)(n.code,{children:"config.yml"}),") with (non-relevant fields omitted):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'... trimmed ...\n\n# Consensus.\nconsensus:\n\n  ... trimmed ...\n\n  # Enable consensus state sync (i.e. CometBFT light client sync).\n  state_sync:\n    enabled: true\n    trust_height: {{ trusted_height }}\n    trust_hash: "{{ trusted_height_hash }}"\n\n... trimmed ...\n\n'})}),"\n",(0,o.jsx)(n.p,{children:"and replace the following variables in the configuration snippet:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{{ trusted_height }}"}),": Trusted height defines the height at which your node should trust the chain."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"{{ trusted_height_hash }}"}),": Trusted height hash defines the hash of the block header corresponding to the trusted height."]}),"\n"]}),"\n",(0,o.jsxs)(n.admonition,{type:"danger",children:[(0,o.jsxs)(n.p,{children:["You need to ",(0,o.jsx)(n.strong,{children:"delete any existing node state"})," (if it exists), otherwise the\nstate sync will be skipped. To do that, follow the ",(0,o.jsx)(n.a,{href:"/node/run-your-node/maintenance/wiping-node-state#state-wipe-and-keep-node-identity",children:"Wiping Node State"}),"\ninstructions."]}),(0,o.jsx)(n.p,{children:"If existing node state is found and state sync is skipped, you will see\nsomething like the following in your node's logs:"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'{"caller":"full.go:709","level":"info","module":"cometbft","msg":"state sync enabled","ts":"2023-11-16T20:06:58.56502593Z"}\n{"caller":"node.go:770","level":"info","module":"cometbft:base","msg":"Found local state with non-zero height, skipping state sync","ts":"2023-11-16T20:06:59.22387592Z"}\n'})})]}),"\n",(0,o.jsx)(n.h3,{id:"obtaining-trusted-height-and-hash",children:"Obtaining Trusted Height and Hash"}),"\n",(0,o.jsx)(n.p,{children:"To obtain the trusted height and the corresponding block header's hash, use one\nof the following options."}),"\n",(0,o.jsx)(n.h4,{id:"block-explorers",children:"Block Explorers"}),"\n",(0,o.jsxs)(n.p,{children:["Browse to one of our block explorers (e.g. ",(0,o.jsx)(n.a,{href:"https://explorer.oasis.io/",children:"Oasis Explorer"}),", ",(0,o.jsx)(n.a,{href:"https://www.oasisscan.com",children:"Oasis Scan"}),") and\nobtain the trusted height and hash there:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Obtain the current block height from the main page, e.g. 4819139."}),"\n",(0,o.jsxs)(n.li,{children:["Click on block height's number to view the block's details and obtain its\nhash, e.g. ",(0,o.jsx)(n.code,{children:"377520acaf7b8011b95686b548504a973aa414abba2db070b6a85725dec7bd21"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"a-trusted-node",children:"A Trusted Node"}),"\n",(0,o.jsx)(n.p,{children:"If you have an existing node that you trust, you can use its status output to\nretrieve the current block height and hash by running:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"oasis-node control status -a unix:/node/data/internal.sock\n"})}),"\n",(0,o.jsx)(n.p,{children:"This will give you output like the following (non-relevant fields omitted):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "software_version": "23.0.5",\n  "identity": {\n    ...\n  },\n  "consensus": {\n    ...\n    "latest_height": 18466200,\n    "latest_hash": "9611c81c7e231a281f1de491047a833364f97c38142a80abd65ce41bce123378",\n    "latest_time": "2023-11-27T08:31:15Z",\n    "latest_epoch": 30760,\n    ...\n  },\n  ...\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["the values you need are ",(0,o.jsx)(n.code,{children:"latest_height"})," and ",(0,o.jsx)(n.code,{children:"latest_hash"}),"."]}),"\n",(0,o.jsx)(n.h4,{id:"public-rosetta-gateway",children:"Public Rosetta Gateway"}),"\n",(0,o.jsx)(n.p,{children:"First obtain the network's Genesis document's hash (e.g. from the Networks Parameters Page):"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["mainnet: ",(0,o.jsx)(n.a,{href:"https://docs.oasis.io/node/mainnet/",children:"bb3d748def55bdfb797a2ac53ee6ee141e54cd2ab2dc2375f4a0703a178e6e55"})]}),"\n",(0,o.jsxs)(n.li,{children:["testnet: ",(0,o.jsx)(n.a,{href:"https://docs.oasis.io/node/testnet/",children:"0b91b8e4e44b2003a7c5e23ddadb5e14ef5345c0ebcb3ddcae07fa2f244cab76"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Query our public Rosetta Gateway instance and obtain the trusted height and hash\nthere (replace the ",(0,o.jsx)(n.code,{children:"<chain-context>"})," with the value obtained in the previous step):"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://rosetta.oasis.io/api/block \\\n-H "Content-Type: application/json" \\\n-d \'{\n    "network_identifier": {\n        "blockchain": "Oasis",\n        "network": "<chain-context>"\n    },\n    "block_identifier": {\n        "index": 0\n    }\n}\'\n'})}),"\n",(0,o.jsx)(n.p,{children:"This will give you output like the following (non-relevant fields omitted):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n\t"block": {\n\t\t"block_identifier": {\n\t\t\t"index": 16787439,\n\t\t\t"hash": "443b71d835dbae7ea6233b06280ab596287d5c45f88fa76a71bf6cc52366592e"\n\t\t},\n    ...\n\t}\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The values you need are ",(0,o.jsx)(n.code,{children:"index"})," and ",(0,o.jsx)(n.code,{children:"hash"}),"."]}),"\n",(0,o.jsx)(n.h4,{id:"oasis-cli",children:"Oasis CLI"}),"\n",(0,o.jsx)(n.p,{children:"Query our public Oasis node's endpoint using the Oasis CLI and obtain the\ntrusted height and hash there:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"oasis network status\n"})}),"\n",(0,o.jsx)(n.p,{children:"This will give you output like the following (non-relevant fields omitted):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "software_version": "23.0.5",\n  "identity": {\n    ...\n  },\n  "consensus": {\n    ...\n    "latest_height": 18466200,\n    "latest_hash": "9611c81c7e231a281f1de491047a833364f97c38142a80abd65ce41bce123378",\n    "latest_time": "2023-11-27T08:31:15Z",\n    "latest_epoch": 30760,\n    ...\n  },\n  ...\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The values you need are ",(0,o.jsx)(n.code,{children:"latest_height"})," and ",(0,o.jsx)(n.code,{children:"latest_hash"})," ."]})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>d});var s=t(6540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);