"use strict";(self.webpackChunkdocs_oasis_io=self.webpackChunkdocs_oasis_io||[]).push([[3729],{248:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"node/run-your-node/keymanager-node/README","title":"Key Manager Node","description":"These instructions are for setting up a key manager node. Key manager nodes run a special runtime that provides confidentiality to other ParaTimes. If you want to run a validator node instead, see the instructions for running a validator node. Similarly, if you want to run a ParaTime node instead, see the instructions for running a ParaTime node.","source":"@site/docs/node/run-your-node/keymanager-node/README.md","sourceDirName":"node/run-your-node/keymanager-node","slug":"/node/run-your-node/keymanager-node/","permalink":"/node/run-your-node/keymanager-node/","draft":false,"unlisted":false,"editUrl":"https://github.com/oasisprotocol/docs/edit/main/docs/node/run-your-node/keymanager-node/README.md","tags":[],"version":"current","lastUpdatedAt":1740674219000,"frontMatter":{},"sidebar":"operators","previous":{"title":"ParaTime Client Node","permalink":"/node/run-your-node/paratime-client-node"},"next":{"title":"Signing Key Manager Policy","permalink":"/node/run-your-node/keymanager-node/signing-key-manager-policy"}}');var t=i(4848),o=i(8453);const s={},d="Key Manager Node",a={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setting up Trusted Execution Environment (TEE)",id:"setting-up-trusted-execution-environment-tee",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Starting the Oasis Node",id:"starting-the-oasis-node",level:2},{value:"Checking Node Status",id:"checking-node-status",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"key-manager-node",children:"Key Manager Node"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["These instructions are for setting up a ",(0,t.jsx)(n.em,{children:"key manager"})," node. Key manager nodes run a special runtime that provides confidentiality to other ParaTimes. If you want to run a ",(0,t.jsx)(n.em,{children:"validator"})," node instead, see the ",(0,t.jsx)(n.a,{href:"/node/run-your-node/validator-node",children:"instructions for running a validator node"}),". Similarly, if you want to run a ",(0,t.jsx)(n.em,{children:"ParaTime"})," node instead, see the ",(0,t.jsx)(n.a,{href:"/node/run-your-node/paratime-node",children:"instructions for running a ParaTime node"}),"."]})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"At time of writing the key manager ParaTime is deployed only on the Testnet to support Cipher and Sapphire ParaTimes, and limited to be run by trustworthy partners."})}),"\n",(0,t.jsx)(n.p,{children:"This guide will cover setting up your key manager node for the Oasis Network. This guide assumes some basic knowledge on the use of command line tools."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.p,{children:["Before following this guide, make sure you've followed the ",(0,t.jsx)(n.a,{href:"../prerequisites",children:"Prerequisites"})," and ",(0,t.jsx)(n.a,{href:"/node/run-your-node/non-validator-node",children:"Run a Non-validator Node"})," sections and have:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Oasis Node binary installed on your system and a dedicated non-root user that will run your Oasis Node."}),"\n",(0,t.jsxs)(n.li,{children:["The chosen top-level ",(0,t.jsx)(n.code,{children:"/node/"})," working directory prepared (feel free to name it as you wish, e.g. ",(0,t.jsx)(n.code,{children:"/srv/oasis/"}),") with:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"etc"}),": This will store the node configuration and genesis file."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"data"}),": This will store the data directory needed by Oasis Node, including your node identity and the blockchain state. The directory permissions should be ",(0,t.jsx)(n.code,{children:"rwx------"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bin"}),": This will store binaries needed by Oasis Node for running the ParaTimes."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"runtimes"}),": This will store the ParaTime bundles."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Downloaded or compiled the correct versions of everything according to Network Parameters page (",(0,t.jsx)(n.a,{href:"/node/mainnet/",children:"Mainnet"}),", ",(0,t.jsx)(n.a,{href:"/node/testnet/",children:"Testnet"}),").","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The genesis file copied to ",(0,t.jsx)(n.code,{children:"/node/etc/genesis.json"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The binaries needed by Oasis Node for running the ParaTimes copied to ",(0,t.jsx)(n.code,{children:"/node/bin/"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The key manager ParaTime bundle (",(0,t.jsx)(n.code,{children:".orc"})," extension) copied to ",(0,t.jsx)(n.code,{children:"/node/runtimes/"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Initialized a new node and updated your entity registration by following the ",(0,t.jsx)(n.a,{href:"/node/run-your-node/paratime-node#register-a-new-entity-or-update-your-entity-registration",children:"Register a New Entity or Update Your Entity Registration"})," instructions.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The entity descriptor file copied to ",(0,t.jsx)(n.code,{children:"/node/etc/entity.json"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Reading the rest of the ",(0,t.jsx)(n.a,{href:"/node/run-your-node/validator-node",children:"validator node setup instructions"})," and ",(0,t.jsx)(n.a,{href:"/node/run-your-node/paratime-node",children:"ParaTime node setup instructions"})," may also be useful."]})}),"\n",(0,t.jsx)(n.h3,{id:"setting-up-trusted-execution-environment-tee",children:"Setting up Trusted Execution Environment (TEE)"}),"\n",(0,t.jsxs)(n.p,{children:["The key manager ParaTime requires the use of a TEE. See the ",(0,t.jsx)(n.a,{href:"/node/run-your-node/prerequisites/set-up-trusted-execution-environment-tee",children:"Set up trusted execution environment"})," doc for instructions on how to set it up before proceeding."]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["In order to configure the node create the ",(0,t.jsx)(n.code,{children:"/node/etc/config.yml"})," file with the following content:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'datadir: /node/data\n\nlog:\n  level:\n    default: info\n    tendermint: info\n    tendermint/context: error\n  format: JSON\n\ngenesis:\n  file: /node/etc/genesis.json\n\nconsensus:\n  tendermint:\n    core:\n      listen_address: tcp://0.0.0.0:26656\n\n      # The external IP that is used when registering this node to the network.\n      # NOTE: If you are using the Sentry node setup, this option should be\n      # omitted.\n      external_address: tcp://{{ external_address }}:26656\n\n    p2p:\n      # List of seed nodes to connect to.\n      # NOTE: You can add additional seed nodes to this list if you want.\n      seed:\n        - "{{ seed_node_address }}"\n\nruntime:\n  mode: keymanager\n  paths:\n    # Path to the key manager ParaTime bundle.\n    - "{{ keymanager_runtime_orc_path }}"\n\n  # The following section is required for ParaTimes which are running inside the\n  # Intel SGX Trusted Execution Environment.\n  sgx:\n    loader: /node/bin/oasis-core-runtime-loader\n\nworker:\n  registration:\n    # In order for the node to register itself, the entity ID must be set.\n    entity_id: {{ entity_id }}\n\n  keymanager:\n    runtime:\n      id: "{{ keymanager_runtime_id }}"\n\n  p2p:\n    # External P2P configuration.\n    port: 20104\n    addresses:\n      # The external IP that is used when registering this node to the network.\n      - "{{ external_address }}:20104"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Before using this configuration you should collect the following information to replace the ",(0,t.jsx)(n.code,{children:"{{ ... }}"})," variables present in the configuration file:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{{ external_address }}"}),": The external IP you used when registering this node."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{{ seed_node_address }}"}),": The seed node address in the form ",(0,t.jsx)(n.code,{children:"ID@IP:port"}),".","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["You can find the current Oasis Seed Node address in the Network Parameters page (",(0,t.jsx)(n.a,{href:"/node/mainnet/",children:"Mainnet"}),", ",(0,t.jsx)(n.a,{href:"/node/testnet/",children:"Testnet"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{{ keymanager_runtime_orc_path }}"}),": Path to the key manager ",(0,t.jsx)(n.a,{href:"/node/run-your-node/paratime-node#the-paratime-bundle",children:"ParaTime bundle"})," of the form ",(0,t.jsx)(n.code,{children:"/node/runtimes/foo-paratime.orc"}),".","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["You can find the current Oasis-supported key manager ParaTime in the Network Parameters page (",(0,t.jsx)(n.a,{href:"/node/mainnet/",children:"Mainnet"}),", ",(0,t.jsx)(n.a,{href:"/node/testnet/",children:"Testnet"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{{ entity_id }}"}),": The node's entity ID from the ",(0,t.jsx)(n.code,{children:"entity.json"})," file."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{{ keymanager_runtime_id }}"}),": Runtime identified for the key manager ParaTime.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["You can find the current Oasis-supported key manager ParaTime identifiers in the Network Parameters page (",(0,t.jsx)(n.a,{href:"/node/mainnet/",children:"Mainnet"}),", ",(0,t.jsx)(n.a,{href:"/node/testnet/",children:"Testnet"}),")."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsxs)(n.p,{children:["Make sure the ",(0,t.jsx)(n.code,{children:"consensus"})," port (default: ",(0,t.jsx)(n.code,{children:"26656"}),") and ",(0,t.jsx)(n.code,{children:"p2p.port"})," (default: ",(0,t.jsx)(n.code,{children:"9200"}),") are exposed and publicly\naccessible on the internet (for ",(0,t.jsx)(n.code,{children:"TCP"})," and ",(0,t.jsx)(n.code,{children:"UDP"})," traffic)."]})}),"\n",(0,t.jsx)(n.h2,{id:"starting-the-oasis-node",children:"Starting the Oasis Node"}),"\n",(0,t.jsx)(n.p,{children:"You can start the node by running the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"oasis-node --config /node/etc/config.yml\n"})}),"\n",(0,t.jsx)(n.h2,{id:"checking-node-status",children:"Checking Node Status"}),"\n",(0,t.jsx)(n.p,{children:"To ensure that your node is properly connected with the network, you can run the following command after the node has started:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"oasis-node control status -a unix:/node/data/internal.sock\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var r=i(6540);const t={},o=r.createContext(t);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);