<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-core/consensus/README" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Consensus Layer | Oasis Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.oasis.io/core/consensus/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Consensus Layer | Oasis Documentation"><meta data-rh="true" name="description" content="Oasis Core is designed around the principle of modularity. The consensus layer"><meta data-rh="true" property="og:description" content="Oasis Core is designed around the principle of modularity. The consensus layer"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://docs.oasis.io/core/consensus/"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/core/consensus/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.oasis.io/core/consensus/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.8caaf724.css">
<script src="/assets/js/runtime~main.0cf6481e.js" defer="defer"></script>
<script src="/assets/js/main.3d5625b3.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="/img/logo_dark.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Oasis Docs" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.svg" alt="Oasis Docs" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/general/">Use Oasis</a><a class="navbar__item navbar__link" href="/build/">Build</a><a class="navbar__item navbar__link" href="/get-involved/">Get Involved</a><a class="navbar__item navbar__link" href="/node/">Run Node</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/core/">Develop Core</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" title="GitHub repository" aria-label="GitHub repository"></a><a href="https://oasisprotocol.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-www-link" title="Oasis Protocol Foundation website" aria-label="Oasis Protocol Foundation website"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/core/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/core/development-setup">Development Setup</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/core/development-setup/build-environment-setup-and-building">Build Environment Setup and Building</a><button aria-label="Expand sidebar category &#x27;Build Environment Setup and Building&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/core/development-setup/running-tests-and-development-networks">Running Tests and Development Networks</a><button aria-label="Expand sidebar category &#x27;Running Tests and Development Networks&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/core/high-level-components">High-Level Components</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" tabindex="0" href="/core/consensus/">Consensus Layer</a><button aria-label="Collapse sidebar category &#x27;Consensus Layer&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/core/consensus/transactions">Transactions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/core/consensus/services">Services</a><button aria-label="Expand sidebar category &#x27;Services&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/core/consensus/genesis">Genesis Document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/core/consensus/test-vectors">Transaction Test Vectors</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/core/runtime/">Runtime Layer</a><button aria-label="Expand sidebar category &#x27;Runtime Layer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/core/oasis-node">Oasis Node</a><button aria-label="Expand sidebar category &#x27;Oasis Node&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/core/common-functionality">Common Functionality</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/core/encoding">Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/core/crypto">Cryptography</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/core/authenticated-grpc">Protocols</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/core/mkvs">Merklized Key-Value Store (MKVS)</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/core/processes">Processes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/core/release-process">Release Process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/core/versioning">Versioning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/core/SECURITY">Security</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/adrs">ADRs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://api.docs.oasis.io/js/client" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Core Client TypeScript API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Core Client Go API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Consensus Layer</h1></header>
<p>Oasis Core is designed around the principle of modularity. The <em>consensus layer</em>
is an interface that provides a number of important services to other parts of
Oasis Core. This allows, in theory, for the consensus backend to be changed. The
different backends live in <a href="https://github.com/oasisprotocol/oasis-core/tree/master/go/consensus" target="_blank" rel="noopener noreferrer"><code>go/consensus</code></a>, with the general interfaces in
<a href="https://github.com/oasisprotocol/oasis-core/tree/master/go/consensus/api" target="_blank" rel="noopener noreferrer"><code>go/consensus/api</code></a>. The general rule is that anything outside of a specific
consensus backend package should be consensus backend agnostic.</p>
<p>For more details about the actual API that the consensus backends must provide
see the <a href="https://pkg.go.dev/github.com/oasisprotocol/oasis-core/go/consensus/api?tab=doc" target="_blank" rel="noopener noreferrer">consensus backend API documentation</a>.</p>
<p>Currently the only supported consensus backend is <a href="https://cometbft.com/" target="_blank" rel="noopener noreferrer">CometBFT</a>, a BFT consensus
protocol. For this reason some API surfaces may not be fully consensus backend
agnostic.</p>
<p>Each consensus backend needs to provide the following services:</p>
<ul>
<li><a href="/core/consensus/services/epochtime">Epoch Time</a>, an epoch-based time keeping service.</li>
<li><a href="/core/consensus/services/beacon">Random Beacon</a>, a source of randomness for other services.</li>
<li><a href="/core/consensus/services/staking">Staking</a>, operations required to operate a PoS blockchain.</li>
<li><a href="/core/consensus/services/registry">Registry</a>, an entity/node/runtime public key and metadata registry service.</li>
<li><a href="/core/consensus/services/scheduler">Committee Scheduler</a> service.</li>
<li><a href="/core/consensus/services/governance">Governance</a> service.</li>
<li><a href="/core/consensus/services/roothash">Root Hash</a>, runtime commitment processing and minimal runtime state keeping
service.</li>
<li><a href="/core/consensus/services/keymanager">Key Manager</a> policy state keeping service.</li>
</ul>
<p>Each of the above services provides methods to query its current state. In order
to mutate the current state, each operation needs to be wrapped into a
<a href="/core/consensus/transactions">consensus transaction</a> and submitted to the consensus layer for processing.</p>
<p>Oasis Core defines an interface for each kind of service (in
<code>go/&lt;service&gt;/api</code>), with all concrete service implementations living together
with the consensus backend implementation. The service API defines the
transaction format for mutating state together with any query methods (both are
consensus backend agnostic).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cometbft">CometBFT<a href="#cometbft" class="hash-link" aria-label="Direct link to CometBFT" title="Direct link to CometBFT">​</a></h2>
<p><img decoding="async" loading="lazy" alt="CometBFT" src="/assets/images/oasis-core-consensus-cometbft-604c57fd4ffe73d71eba188e6cff9a3f.svg" class="img_ev3q"></p>
<p>The CometBFT consensus backend lives in <a href="https://github.com/oasisprotocol/oasis-core/tree/master/go/consensus/cometbft" target="_blank" rel="noopener noreferrer"><code>go/consensus/cometbft</code></a>.</p>
<p>For more information about CometBFT itself see
<a href="https://docs.cometbft.com/" target="_blank" rel="noopener noreferrer">the CometBFT Core developer documentation</a>. This section assumes familiarity
with the CometBFT Core concepts and APIs. When used as an Oasis Core consensus
backend, CometBFT Core is used as a library and thus lives in the same
process.</p>
<p>The CometBFT consensus backend is split into two major parts:</p>
<ol>
<li>
<p>The first part is the <strong>ABCI application</strong> that represents the core logic
that is replicated by CometBFT Core among the network nodes using the
CometBFT BFT protocol for consensus.</p>
</li>
<li>
<p>The second part is the <strong>query and transaction submission glue</strong> that makes
it easy to interact with the ABCI application, presenting everything via the
Oasis Core Consensus interface.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="abci-application-multiplexer">ABCI Application Multiplexer<a href="#abci-application-multiplexer" class="hash-link" aria-label="Direct link to ABCI Application Multiplexer" title="Direct link to ABCI Application Multiplexer">​</a></h3>
<p>CometBFT Core consumes consensus layer logic via the <a href="https://github.com/cometbft/cometbft/blob/master/spec/abci/abci.md" target="_blank" rel="noopener noreferrer">ABCI protocol</a>, which
assumes a single application. Since we have multiple services that need to be
provided by the consensus layer we use an <em>ABCI application multiplexer</em> which
performs some common functions and dispatches transactions to the appropriate
service-specific handler.</p>
<p>The multiplexer lives in <a href="https://github.com/oasisprotocol/oasis-core/tree/master/go/consensus/cometbft/abci/mux.go" target="_blank" rel="noopener noreferrer"><code>go/consensus/cometbft/abci/mux.go</code></a> with the
multiplexed applications, generally corresponding to services required by the
<em>consensus layer</em> interface living in <a href="https://github.com/oasisprotocol/oasis-core/tree/master/go/consensus/cometbft/apps" target="_blank" rel="noopener noreferrer"><code>go/consensus/cometbft/apps/&lt;app&gt;</code></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="state-storage">State Storage<a href="#state-storage" class="hash-link" aria-label="Direct link to State Storage" title="Direct link to State Storage">​</a></h3>
<p>All application state for the CometBFT consensus backend is stored using our
<a href="/core/mkvs">Merklized Key-Value Store</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-implementations">Service Implementations<a href="#service-implementations" class="hash-link" aria-label="Direct link to Service Implementations" title="Direct link to Service Implementations">​</a></h3>
<p>Service implementations for the CometBFT consensus backend live in
<a href="https://github.com/oasisprotocol/oasis-core/tree/master/go/consensus/cometbft" target="_blank" rel="noopener noreferrer"><code>go/consensus/cometbft/&lt;service&gt;</code></a>. They provide the glue between the
services running as part of the ABCI application multiplexer and the Oasis Core
service APIs. The interfaces generally provide a read-only view of the consensus
layer state at a given height. Internally, these perform queries against the
ABCI application state.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="queries">Queries<a href="#queries" class="hash-link" aria-label="Direct link to Queries" title="Direct link to Queries">​</a></h4>
<p>Queries do not use the <a href="https://github.com/cometbft/cometbft/blob/master/spec/abci/abci.md#query-1" target="_blank" rel="noopener noreferrer">ABCI query functionality</a> as that would incur needless
overhead for our use case (with CometBFT Core running in the same process).
Instead, each multiplexed service provides its own <code>QueryFactory</code> which can be
used to query state at a specific block height.</p>
<p>An example of a <code>QueryFactory</code> and the corresponding <code>Query</code> interfaces for the
staking service are as follows:</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// QueryFactory is the staking query factory interface.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type QueryFactory interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QueryAt(ctx context.Context, height int64) (Query, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Query is the staking query interface.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type Query interface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TotalSupply(ctx context.Context) (*quantity.Quantity, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CommonPool(ctx context.Context) (*quantity.Quantity, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LastBlockFees(ctx context.Context) (*quantity.Quantity, error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... further query methods omitted ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Implementations of this interface generally directly access the underlying ABCI
state storage to answer queries. CometBFT implementations of Oasis Core
consensus services generally follow the following pattern (example from the
staking service API for querying <code>TotalSupply</code>):</p>
<div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">func (s *staking) TotalSupply(ctx context.Context, height int64) (*quantity.Quantity, error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    q, err := s.querier.QueryAt(ctx, height)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err != nil {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return nil, err</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return q.TotalSupply(ctx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="transactions">Transactions<a href="#transactions" class="hash-link" aria-label="Direct link to Transactions" title="Direct link to Transactions">​</a></h4>
<p>Each <a href="/core/consensus/transactions">serialized signed Oasis Core transaction</a> directly corresponds to a
<a href="https://docs.cometbft.com/v0.38/core/using-cometbft#transactions" target="_blank" rel="noopener noreferrer">CometBFT transaction</a>. Submission is performed by pushing the serialized
transaction bytes into the <a href="https://github.com/cometbft/cometbft/blob/master/spec/abci/abci.md#mempool-connection" target="_blank" rel="noopener noreferrer">mempool</a> where it first undergoes basic checks and
is then gossiped to the CometBFT P2P network.</p>
<p>Handling of basic checks and transaction execution is performed by the ABCI
application multiplexer mentioned above.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/oasisprotocol/oasis-core/edit/stable/24.2.x/docs/consensus/README.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-12-20T11:18:18.000Z" itemprop="dateModified">Dec 20, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/core/high-level-components"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">High-Level Components</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/core/consensus/transactions"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Transactions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cometbft" class="table-of-contents__link toc-highlight">CometBFT</a><ul><li><a href="#abci-application-multiplexer" class="table-of-contents__link toc-highlight">ABCI Application Multiplexer</a></li><li><a href="#state-storage" class="table-of-contents__link toc-highlight">State Storage</a></li><li><a href="#service-implementations" class="table-of-contents__link toc-highlight">Service Implementations</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">General</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://explorer.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Explorer</a></li><li class="footer__item"><a href="https://wallet.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wallet</a></li><li class="footer__item"><a href="https://github.com/oasisprotocol/cli" target="_blank" rel="noopener noreferrer" class="footer__link-item">CLI</a></li><li class="footer__item"><a href="https://status.oasis.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status</a></li></ul></div><div class="col footer__col"><div class="footer__title">Build</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://faucet.testnet.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Testnet Faucet</a></li><li class="footer__item"><a href="https://playground.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground</a></li><li class="footer__item"><a href="https://api.docs.oasis.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Node</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/node/mainnet/">Mainnet</a></li><li class="footer__item"><a class="footer__link-item" href="/node/testnet/">Testnet</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://oasis.io/discord" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://t.me/oasisprotocolcommunity" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC35UFPcZ2F1wjPxhPrSsESQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://github.com/oasisprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
<p xmlns:cc="http://creativecommons.org/ns#">Copyright © 2025
by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://oasisprotocol.org">
Oasis Protocol Foundation</a>.
Unless otherwise specified, all text and images on this website are licensed
under <a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
CC BY 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="/img/cc.svg"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="/img/by.svg"></a>.
This does not include the Oasis software and the code examples, both of which are
licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
Apache 2.0</a>. Built with &#x2665; and Docusaurus.</p></div></div></div></footer></div>
</body>
</html>